<div class="game-container">
  @if (triviaService.isUsingFallback()) {
    <div class="api-limit-banner">
      ‚ö†Ô∏è API limit reached. Using pre-generated riddles for this session.
    </div>
  }
  
  <div class="game-header">
    <div class="header-info">
      <h1>{{ triviaService.triviaState().category }}</h1>
    </div>
    
    <div class="score-display">
      <span class="score-label">Score:</span>
      <span class="score-value">{{ triviaService.triviaState().score }}</span>
    </div>
  </div>

  <div class="progress-section">
    <div class="progress-text">
      Question {{ triviaService.progress().current }} of {{ triviaService.progress().total }}
    </div>
    <div class="progress-bar">
      <div 
        class="progress-fill" 
        [style.width.%]="(triviaService.progress().current / triviaService.progress().total) * 100"
      ></div>
    </div>
  </div>

  @if (triviaService.currentQuestion(); as question) {
    <div class="question-section">
      <h2 class="question-text">{{ question.question }}</h2>
      <p class="points-info">{{ question.points }} points</p>
    </div>

    <div class="answer-input-section">
      <div class="input-group">
        <input
          type="text"
          class="riddle-input"
          placeholder="Type your answer here..."
          [value]="selectedAnswer() || ''"
          (input)="onAnswerInput($any($event.target).value)"
          (keyup.enter)="submitAnswer()"
          [disabled]="showResult()"
          [class.correct-input]="showResult() && isCorrect()"
          [class.wrong-input]="showResult() && !isCorrect()"
        />
        <button
          class="submit-answer-btn"
          [disabled]="!canSubmit()"
          (click)="submitAnswer()"
        >
          Submit Answer
        </button>
      </div>
      
      @if (showResult() && !isCorrect() && question.correctAnswer) {
        <div class="correct-answer-reveal">
          <span class="label">Correct Answer:</span>
          <span class="answer">{{ question.correctAnswer }}</span>
        </div>
      }
    </div>

    @if (showResult()) {
      <div class="feedback-section" [class.correct]="isCorrect()" [class.incorrect]="!isCorrect()">
        <div class="feedback-header">
          @if (isCorrect()) {
            <span class="feedback-icon">üéâ</span>
            <h3>Correct!</h3>
          } @else {
            <span class="feedback-icon">üòî</span>
            <h3>Incorrect</h3>
          }
        </div>
        
        @if (isCorrect()) {
          <p class="points-feedback">+{{ pointsEarned() }} points!</p>
        } @else {
          <p class="correct-answer">Correct answer: <strong>{{ question.correctAnswer }}</strong></p>
        }
        
        @if (question.explanation) {
          <p class="explanation">{{ question.explanation }}</p>
        }
      </div>
    }

    <div class="action-buttons">
      @if (showResult()) {
        <button
          class="next-btn"
          (click)="nextQuestion()"
        >
          {{ getButtonText() }}
        </button>
      }
    </div>
  }
</div>

